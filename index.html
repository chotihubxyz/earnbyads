<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <title>Earn By Ads</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Monetag SDK -->
  <script src='//libtl.com/sdk.js' data-zone='9700803' data-sdk='show_9700803'></script>
  <style>
    body{margin:0;font-family: Arial, sans-serif;background: linear-gradient(180deg,#f0f9ff,#dff0ff);}
    .wrap{max-width:440px;margin:18px auto 120px;padding:18px;}
    .card{background:#fff;border-radius:14px;box-shadow:0 6px 20px rgba(12,35,55,0.08);padding:18px;}
    .balance{display:flex;justify-content:space-between;gap:12px;padding:12px;background:linear-gradient(90deg,rgba(11,121,208,0.06),rgba(46,139,87,0.03));border-radius:10px;margin-bottom:12px;}
    .balance .amount{font-size:1.6rem;font-weight:700;color:#2e8b57}
    .balance .meta{font-size:13px;color:#59616a}
    .limit{text-align:center;margin-bottom:12px;color:#59616a;font-size:14px;}
    .status{height:26px;text-align:center;margin-bottom:12px;font-weight:600;}
    .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:12px;}
    .btn{
      background:#0b79d0;color:#fff;border:none;padding:10px 14px;border-radius:9px;
      cursor:pointer;font-weight:600;box-shadow:0 6px 12px rgba(11,121,208,0.12);
      text-decoration:none;display:inline-block;text-align:center;
      transition: background 0.2s,transform 0.18s;
    }
    .btn:active{background:#2979ff;transform:scale(.98);}
    .footer{position:fixed;left:0;right:0;bottom:0;background:rgba(255,255,255,0.98);border-top:1px solid #e7eef8;padding:10px 8px;display:flex;justify-content:center;gap:10px;z-index:1200;box-shadow:0 -6px 20px rgba(12,35,55,0.03);}
    /* Spin Wheel Digital Design */
    .spin-card{
      margin: 22px 0 20px 0;
      padding: 18px 0 6px 0;
      background: linear-gradient(120deg,#f9d423,#ff4e50,#43cea2,#185a9d);
      border-radius: 18px;
      box-shadow: 0 8px 26px rgba(0,0,0,0.10);
      text-align: center;
      position: relative;
    }
    .spin-wheel-outer {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      position:relative;
    }
    #spinSVG {
      filter: drop-shadow(0 4px 18px #0002) blur(0.1px);
      border-radius:50%;
      background:radial-gradient(#fff8 62%,#fff0 100%);
      transition: filter .35s;
      cursor: pointer;
    }
    .spin-indicator {
      position:absolute; left:50%; top:1px; transform:translateX(-50%);
      z-index:2; pointer-events:none;
    }
    .spin-label-main {
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      font-size:2.1rem;font-family:'Orbitron',monospace,sans-serif;font-weight:900;
      color:#fff;background:rgba(44,44,44,0.85);padding:7px 22px 6px 22px;border-radius:25px;
      box-shadow:0 4px 12px #0002,0 1px 0 #fff3 inset;
      letter-spacing:.08em;text-shadow:0 2px 10px #2227,0 1px 0 #fff8;
      pointer-events:auto;user-select:none;z-index:5;
      border:2.5px solid #ffd600;
      cursor:pointer;
    }
    .spin-prize-label {
      position:absolute;top:60%;left:50%;transform:translate(-50%,30px) scale(1.1);
      font-size:2.1rem;font-family:'Orbitron',monospace,sans-serif;font-weight:900;
      color:#0b79d0;background:#fffbe9ea;padding:5px 16px 4px 16px;border-radius:18px;
      box-shadow:0 2px 8px #0003;
      letter-spacing:.05em;text-shadow:0 1px 4px #fff7;
      opacity:0;transition:opacity .5s,transform .45s;
      z-index:15;
      pointer-events:none;user-select:none;
      border:2px solid #f2e76a;
    }
    .spin-prize-label.show {
      opacity:1;transform:translate(-50%,10px) scale(1.20);
    }
    /* Withdraw Modal */
    .modal-bg {
      display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(32,32,32,0.18);z-index:2100;
    }
    .modal {
      display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      min-width:310px;max-width:98vw;background:#fff;border-radius:13px;padding:20px 16px 18px 16px;
      box-shadow:0 8px 40px #0005;z-index:2200;
    }
    .modal h2 {margin-top:0;color:#0b79d0;font-size:1.22rem;}
    .modal label{display:block;margin:10px 0 3px 3px;font-size:14px;}
    .modal input[type="text"], .modal input[type="number"] {
      width:98%;padding:8px 7px;font-size:15px;border-radius:6px;border:1px solid #ddd;margin-bottom:10px;
    }
    .modal .withdraw-methods label {display:inline-block;margin-right:14px;}
    .modal .modal-actions{margin-top:8px;text-align:right;}
    .modal .modal-close-btn{background:#eee;color:#0b79d0;font-weight:bold;margin-right:8px;}
    .modal .error-msg{color:#d32f2f;font-size:13px;height:18px;margin-bottom:5px;}
    .modal .success-msg{color:#267d31;font-size:13px;height:18px;margin-bottom:5px;}
    /* Refer Popup */
    .popup {
      display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      min-width:280px;max-width:94vw;background:#fff;
      border-radius:14px;padding:18px 13px 12px 14px;
      box-shadow:0 8px 36px #0003;z-index:2300;
      text-align:center;
    }
    .popup h3{margin:4px 0 11px 0;color:#0b79d0;font-size:1.18rem;}
    .popup input[type="text"]{width:91%;padding:6px 5px;font-size:15px;border-radius:6px;border:1px solid #ddd;margin-bottom:8px;}
    .popup .btn{margin:6px 9px 0 0;}
    .popup .refer-link{font-size:15px;color:#267d31;word-break:break-all;margin:5px 0 12px 0;}
    .popup .count-label{font-size:15px;color:#0b79d0;margin:8px 0;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Earn By Ads</h1>
        <div class="subtitle">Watch ads → earn. Refer friends → extra bonus.</div>
      </header>
      <div class="balance">
        <div>
          <div class="small-muted">Your Balance</div>
          <div class="amount">$ <span id="balanceAmount">0.00</span></div>
        </div>
        <div class="meta">
          <div class="small-muted">Ref Earnings</div>
          <div id="refEarnings">$0.00</div>
        </div>
      </div>
      <div class="limit">Today's remaining ad views: <strong id="adLimit">100</strong></div>
      <div class="status" id="status"></div>
      <div class="actions">
        <button class="btn" id="watchAdBtn">▶️Watch Ads1</button>
        <button class="btn" id="bonus1Btn">▶️Watch Ads2</button>
      </div>
      <!-- SPIN SECTION -->
      <div class="spin-card" style="margin-top:22px;">
        <div class="spin-wheel-outer" style="margin-bottom:0;">
          <svg id="spinSVG" width="180" height="180" viewBox="0 0 180 180"></svg>
          <div class="spin-indicator">
            <svg width="38" height="38" viewBox="0 0 38 38">
              <polygon points="19,2 36,38 2,38" fill="#ffd600" stroke="#222" stroke-width="2"/>
            </svg>
          </div>
          <div class="spin-label-main" id="spinLabelMain" style="cursor:pointer;">SPIN</div>
          <div class="spin-prize-label" id="spinPrizeLabel">+0.00</div>
        </div>
      </div>
      <!-- END SPIN SECTION -->
    </div>
  </div>
  <!-- Refer Popup -->
  <div class="popup" id="referPopup">
    <h3>Refer & Earn</h3>
    <div class="refer-link" id="inviteBox"></div>
    <button class="btn" id="copyReferBtn">Copy Link</button>
    <button class="btn" id="closeReferBtn">Close</button>
  </div>
  <!-- Referrals Count Popup -->
  <div class="popup" id="refCountPopup">
    <h3>Total Referrals</h3>
    <div class="count-label">You have <span id="refCountText">0</span> referrals.</div>
    <button class="btn" id="closeRefCountBtn">Close</button>
  </div>
  <!-- Withdraw Modal -->
  <div class="modal-bg" id="wdModalBg"></div>
  <div class="modal" id="withdrawModal">
    <h2>Withdraw</h2>
    <div class="error-msg" id="wdErrorMsg"></div>
    <form id="withdrawForm" autocomplete="off">
      <label>Withdraw Method:</label>
      <div class="withdraw-methods">
        <label><input type="radio" name="wdMethod" value="Bkash" checked> Bkash</label>
        <label><input type="radio" name="wdMethod" value="Nagad"> Nagad</label>
        <label><input type="radio" name="wdMethod" value="USDT"> USDT</label>
      </div>
      <label for="wdAccount">Account/Wallet Number:</label>
      <input type="text" id="wdAccount" required autocomplete="off" placeholder="Enter account or wallet number">
      <label for="wdAmount">Withdraw Amount (min $50):</label>
      <input type="number" id="wdAmount" step="0.01" min="50" required placeholder="Enter amount">
      <div class="modal-actions">
        <button type="button" class="btn modal-close-btn" id="closeWithdrawModal">Cancel</button>
        <button type="submit" class="btn">Withdraw</button>
      </div>
      <div class="success-msg" id="wdSuccessMsg"></div>
    </form>
  </div>
  <!-- Footer -->
  <div class="footer">
    <button class="btn" id="withdrawBtn">Withdraw</button>
    <button class="btn" id="referBtn">Refer</button>
    <button class="btn" id="refCountBtn">Referrals Count</button>
  </div>
  <script>
    // Spin section config and logic
    const spinRewards = [0.02, 0.05, 0.10, 0.15, 0.02, 0.04];
    const spinColors = ["#ff5252","#ffd600","#00e676","#2979ff","#f500a0","#ff9100"];
    const spinSVG = document.getElementById("spinSVG");
    const spinLabelMain = document.getElementById("spinLabelMain");
    const spinPrizeLabel = document.getElementById("spinPrizeLabel");
    let spinning = false, angleOffset = 0;

    function drawWheel() {
      let slices = spinRewards.length;
      let center = 90, radius = 88;
      spinSVG.innerHTML = "";
      // Draw slices
      for(let i=0; i<slices; i++){
        let startAngle = (i/slices)*2*Math.PI - Math.PI/2;
        let endAngle = ((i+1)/slices)*2*Math.PI - Math.PI/2;
        let x1 = center + radius * Math.cos(startAngle);
        let y1 = center + radius * Math.sin(startAngle);
        let x2 = center + radius * Math.cos(endAngle);
        let y2 = center + radius * Math.sin(endAngle);
        let largeArc = (endAngle-startAngle > Math.PI) ? 1 : 0;
        let path = [
          `M${center},${center}`,
          `L${x1},${y1}`,
          `A${radius},${radius} 0 ${largeArc} 1 ${x2},${y2}`,
          "Z"
        ].join(" ");
        let slice = document.createElementNS("http://www.w3.org/2000/svg", "path");
        slice.setAttribute("d", path);
        slice.setAttribute("fill", spinColors[i]);
        slice.setAttribute("stroke", "#fff");
        slice.setAttribute("stroke-width", "2");
        spinSVG.appendChild(slice);
      }
      // Draw labels
      for(let i=0; i<slices; i++){
        let angle = ((i+0.5)/slices)*2*Math.PI - Math.PI/2;
        let tx = center + (radius-26)*Math.cos(angle);
        let ty = center + (radius-26)*Math.sin(angle);
        let text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", tx);
        text.setAttribute("y", ty+6);
        text.setAttribute("text-anchor","middle");
        text.setAttribute("fill","#222");
        text.setAttribute("font-size","1.22rem");
        text.setAttribute("font-family","Orbitron,Arial,sans-serif");
        text.setAttribute("font-weight","bold");
        text.textContent = "$"+spinRewards[i].toFixed(2);
        spinSVG.appendChild(text);
      }
    }
    drawWheel();

    // Spin event: clicking spin-label-main triggers the spin and shows Rewarded Popup ad (no direct link)
    spinLabelMain.onclick = function(){
      if(spinning) return;
      spinning=true;
      spinLabelMain.innerText="SPIN";
      spinPrizeLabel.classList.remove("show");
      let slices = spinRewards.length;
      let idx = Math.floor(Math.random() * slices);
      let reward = spinRewards[idx];
      let sliceAngle = 360/slices;
      let randomOffset = Math.random()*sliceAngle - sliceAngle/2;
      let finalAngle = 360*5 + (360 - idx*sliceAngle - sliceAngle/2 + randomOffset);
      angleOffset = (angleOffset + finalAngle) % 360;
      spinSVG.style.transition = "transform 2.7s cubic-bezier(.23,1.57,.51,.97)";
      spinSVG.style.transform = `rotate(${finalAngle}deg)`;
      spinSVG.style.filter = "drop-shadow(0 8px 40px #0b79d099) blur(0.5px)";

      setTimeout(()=>{
        spinSVG.style.transition = "";
        spinSVG.style.transform = `rotate(${(finalAngle%360)}deg)`;
        spinSVG.style.filter = "drop-shadow(0 4px 18px #0002) blur(0.1px)";
        spinLabelMain.innerText = "WIN!";
        spinPrizeLabel.innerText = `+${reward.toFixed(2)}`;
        spinPrizeLabel.classList.add("show");

        // Rewarded Popup ad show (no direct link)
        if(typeof show_9700803 === 'function'){
          show_9700803('pop').then(()=>{
            let state = JSON.parse(localStorage.getItem('earn_state_v2')||'null');
            if(state){
              state.balance = +(state.balance + reward).toFixed(2);
              localStorage.setItem('earn_state_v2',JSON.stringify(state));
              if(typeof updateUI==='function') updateUI();
            }
          }).catch(()=>{
            // If ad not completed, do not add reward
          });
        }

        setTimeout(()=>{
          spinPrizeLabel.classList.remove("show");
          spinLabelMain.innerText="SPIN";
          spinning=false;
        }, 3000);
      }, 2750);
    };

    // ---- Demo balance system for ad buttons ----
    const DAILY_AD_LIMIT = 100;
    const WATCH_REWARD = 0.05;
    const BONUS_REWARD = 0.06;
    const REF_REWARD = 0.50;
    // লোকালস্টোরেজ থেকে স্টেট লোড/সেট
    let state = JSON.parse(localStorage.getItem('earn_state_v2') || 'null');
    if(!state){
      state = {balance:0,dailyAdCount:0,referralCount:0,lastResetDate:new Date().toDateString(),creditedRefs:{}};
      saveState();
    }
    function saveState(){localStorage.setItem('earn_state_v2', JSON.stringify(state));}
    function updateUI(){
      document.getElementById('balanceAmount').innerText = state.balance.toFixed(2);
      document.getElementById('refEarnings').innerText = '$'+(state.referralCount*REF_REWARD).toFixed(2);
      document.getElementById('adLimit').innerText = Math.max(DAILY_AD_LIMIT-state.dailyAdCount,0);
      document.getElementById('refCountText').innerText = state.referralCount;
    }
    function showStatus(msg,color='info',time=2000){
      let el=document.getElementById('status');
      el.innerText=msg;
      el.style.color=color==='success'?'green':(color==='error'?'red':'#0b79d0');
      setTimeout(()=>{el.innerText='';},time);
    }

    // Watch Ad 1: Rewarded Popup (রিওয়ার্ডসহ সরাসরি অফার পেজ)
    document.getElementById('watchAdBtn').onclick = function() {
      if(state.dailyAdCount >= DAILY_AD_LIMIT) { showStatus("Limit reached",'error'); return; }
      if(typeof show_9700803 !== 'function') { showStatus("Ad not ready",'error'); return; }
      show_9700803('pop').then(()=>{
        state.dailyAdCount++;
        state.balance = +(state.balance + BONUS_REWARD).toFixed(2);
        saveState();
        updateUI();
        showStatus(`+ $${BONUS_REWARD.toFixed(2)}`, 'success');
      }).catch(()=>{
        showStatus('Ad not completed', 'error');
      });
    };

    // Watch Ad 2: Rewarded Interstitial (রিওয়ার্ডসহ ব্যানার অ্যাড)
    document.getElementById('bonus1Btn').onclick = function() {
      if(state.dailyAdCount >= DAILY_AD_LIMIT) { showStatus("Limit reached",'error'); return; }
      if(typeof show_9700803 !== 'function') { showStatus("Ad not ready",'error'); return; }
      show_9700803().then(()=>{
        state.dailyAdCount++;
        state.balance = +(state.balance + WATCH_REWARD).toFixed(2);
        saveState();
        updateUI();
        showStatus(`+ $${WATCH_REWARD.toFixed(2)}`,'success');
      }).catch(()=>{
        showStatus('Ad not completed','error');
      });
    };

    // Refer system
    let userId = localStorage.getItem('earn_user_id_v2');
    if(!userId){
      userId='u'+Date.now().toString(36)+Math.floor(Math.random()*9000+1000);
      localStorage.setItem('earn_user_id_v2',userId);
    }
    // Use fixed app link for refer
    const inviteURL = 'https://t.me/earnbyadbot/?ref=' + userId;
    document.getElementById('inviteBox').innerText = inviteURL;
    document.getElementById('copyReferBtn').onclick = ()=>{navigator.clipboard.writeText(inviteURL);showStatus("Link copied",'success');};
    // Incoming ref detection
    const params=new URLSearchParams(location.search);
    if(params.has('ref')){
      const refId=params.get('ref');
      if(refId && refId!==userId && !state.creditedRefs[refId]){
        state.creditedRefs[refId]=true;state.referralCount++;
        state.balance=+(state.balance+REF_REWARD).toFixed(2);
        saveState();updateUI();showStatus(`+ $${REF_REWARD.toFixed(2)} referral`,'success');
      }
    }

    // Refer Popup handling
    document.getElementById('referBtn').onclick=()=>{document.getElementById('referPopup').style.display='block';};
    document.getElementById('closeReferBtn').onclick=()=>{document.getElementById('referPopup').style.display='none';};
    document.getElementById('refCountBtn').onclick=()=>{
      document.getElementById('refCountText').innerText=state.referralCount;
      document.getElementById('refCountPopup').style.display='block';
    };
    document.getElementById('closeRefCountBtn').onclick=()=>{document.getElementById('refCountPopup').style.display='none';};

    updateUI();

    // Withdraw Modal JS
    const withdrawBtn = document.getElementById('withdrawBtn');
    const withdrawModal = document.getElementById('withdrawModal');
    const wdModalBg = document.getElementById('wdModalBg');
    const closeWithdrawModal = document.getElementById('closeWithdrawModal');
    const wdErrorMsg = document.getElementById('wdErrorMsg');
    const wdSuccessMsg = document.getElementById('wdSuccessMsg');
    const withdrawForm = document.getElementById('withdrawForm');
    withdrawBtn.onclick = function() {
      wdErrorMsg.innerText = "";
      wdSuccessMsg.innerText = "";
      document.getElementById('wdAccount').value = "";
      document.getElementById('wdAmount').value = "";
      withdrawModal.style.display = 'block';
      wdModalBg.style.display = 'block';
    };
    function closeWModal() {
      withdrawModal.style.display = 'none';
      wdModalBg.style.display = 'none';
    }
    closeWithdrawModal.onclick = closeWModal;
    wdModalBg.onclick = closeWModal;

    withdrawForm.onsubmit = function(e) {
      e.preventDefault();
      wdErrorMsg.innerText = "";
      wdSuccessMsg.innerText = "";
      let method = withdrawForm.wdMethod.value;
      let account = document.getElementById('wdAccount').value.trim();
      let amount = parseFloat(document.getElementById('wdAmount').value);
      if(!account) {
        wdErrorMsg.innerText = "Account/Wallet number required!";
        return;
      }
      if(isNaN(amount) || amount < 50) {
        wdErrorMsg.innerText = "Minimum withdraw $50!";
        return;
      }
      if(amount > state.balance) {
        wdErrorMsg.innerText = "Insufficient balance!";
        return;
      }
      state.balance = +(state.balance - amount).toFixed(2);
      saveState();
      updateUI();
      wdSuccessMsg.innerText = `Withdraw request ($${amount.toFixed(2)}) sent via ${method}.`;
      setTimeout(closeWModal, 1700);
    };
  </script>
</body>
            </html>
